"0","# helper: map clusters -> labels by majority vote, then accuracy/sens/spec"
"0","cluster_metrics <- function(cl, truth = diagnosis) {"
"0","  tab <- table(cl, truth)"
"0","  map <- apply(tab, 1, function(r) names(which.max(r)))"
"0","  pred <- factor(map[as.character(cl)], levels = levels(truth))"
"0","  cm <- table(pred, truth)"
"0","  acc <- mean(pred == truth)"
"0","  sens <- cm[""M"",""M""] / sum(cm[ , ""M""])        # TPR for Malignant"
"0","  spec <- cm[""B"",""B""] / sum(cm[ , ""B""])        # TNR for Benign"
"0","  list(acc = acc, sens = sens, spec = spec, cm = cm)"
"0","}"
"0",""
"0","# evaluate cutting the PC-space tree at k = 2:10"
"0","ks <- 2:10"
"0","pc_k_results <- lapply(ks, function(k){"
"0","  cl <- cutree(wisc.pr.hclust, k = k)"
"0","  cluster_metrics(cl)"
"0","})"
"0","acc_by_k <- sapply(pc_k_results, `[[`, ""acc"")"
"0","data.frame(k = ks, accuracy = round(acc_by_k, 4))"
