wisc.df <- read.csv("WisconsinCancer.csv", row.names=1)
head(wisc.df)
wisc.df$diagnosis
wisc.df[,-1]
wisc.data <- wisc.df[,-1]\
wisc.data <- wisc.df[,-1]
dim(wisc.data)
diagnosis <- factor(wisc.df$diagnosis)
r <- nrow(wisc.data)
nrow(wisc.data)
table(wisc.df$diagnosis)
colnames(wisc.data)
#colnames(wisc.data)
grep("_mean")
#colnames(wisc.data)
grep("_mean", colnames(wisc.data))
#colnames(wisc.data)
grep("_mean", colnames(wisc.data), value = T)
#grep(): searches for matches to a specified pattern within each element of a character vector x.
#colnames(wisc.data)
leangth(grep("_mean", colnames(wisc.data), value = T))
#colnames(wisc.data)
length(grep("_mean", colnames(wisc.data), value = T))
#grep(): searches for matches to a specified pattern within each element of a character vector x.
#colnames(wisc.data)
length(grep("_mean", colnames(wisc.data)))
#grep(): searches for matches to a specified pattern within each element of a character vector x.
#length(): how many
wisc.pr <- prcomp(wisc.data, scale = TRUE)
summary(wisc.pr)
library(ggplot2)
wisc.pr$x
library(ggplot2)
ggplot(wisc.pr$x, c(PC1, PC2))
library(ggplot2)
ggplot(wisc.data) +
aes(PC1, PC2) +
geom_point()
library(ggplot2)
ggplot(wisc.data, cp; = diagnosis) +
library(ggplot2)
ggplot(wisc.data, col = diagnosis) +
aes(PC1, PC2) +
geom_point()
library(ggplot2)
ggplot(wisc.pr$x) +
aes(PC1, PC2, col = diagnosis) +
geom_point()
?prcomp()
head(wisc.df$diagnosis)
wisc.data <- wisc.df[,-1]
#[ ]: subsetting R objects, including data frames, vectors, and matrices.
#,: [rows, columns]
#-1: exclude the first column/row
dim(wisc.data)
#dim(): get the dimensions of the wisc.data object - returns a vector with two numbers: # of rows and # of columns
diagnosis <- factor(wisc.df$diagnosis)
table(wisc.df$diagnosis)
#table(): output a table displaying the counts of each unique value present in the diagnosis column of your wisc.df data frame
colnames(wisc.data)
#colnames(): output a character vector containing the names of the columns.
#colnames(wisc.data)
length(grep("_mean", colnames(wisc.data)))
#grep(): searches for matches to a specified pattern within each element of a character vector x.
#length(): how many
wisc.pr <- prcomp(wisc.data, scale = TRUE)
summary(wisc.pr)
library(ggplot2)
ggplot(wisc.pr$x) +
aes(PC1, PC2, col = diagnosis) +
geom_point()
var <- var.tbl$importance[2,]
pr.var <- wisc.pr$sdev^2
head(pr.var)
# Variance explained by each principal component: pve
pve <- pr.var / sum(pr.var)
# Plot variance explained for each principal component
plot(pve, xlab = "Principal Component",
ylab = "Proportion of Variance Explained",
ylim = c(0, 1), type = "o")
# Alternative scree plot of the same data, note data driven y-axis
barplot(pve, ylab = "Precent of Variance Explained",
names.arg=paste0("PC",1:length(pve)), las=2, axes = FALSE)
axis(2, at=pve, labels=round(pve,2)*100 )
## ggplot based graph
#install.packages("factoextra")
library(factoextra)
install.packages("factoextra")
## ggplot based graph
#install.packages("factoextra")
library(factoextra)
fviz_eig(wisc.pr, addlabels = TRUE)
summary(wisc.pr)
wisc.pr$rotation["concave.point_mean",1]
wisc.pr$rotation["concave.points_mean",1]
wisc.pr$rotation["concave.points_mean", "PC1"]
data.scaled <- scale(wisc.data)
data.dist <- dist(data.scaled)
wisc.hclust <- hclust(data.dist)
plot(wisc.hclust)
table(cutree(wisc.hclust, k=4))
diagnosis
wisc.hclust.clusters <- table(cutree(wisc.hclust, k=4))
table(wisc.hclust.clusters, diagnosis)
wisc.hclust.clusters <- table(cutree(wisc.hclust, k=4))
table(wisc.hclust.clusters)
table(wisc.hclust.clusters, diagnosis)
table(wisc.hclust.clusters, diagnosis)
table(wisc.hclust.clusters, diagnosis)
table(wisc.hclust.clusters, diagnosis)
wisc.hclust.clusters <- cutree(wisc.hclust, k=4)
table(wisc.hclust.clusters)
table(wisc.hclust.clusters, diagnosis)
wisc.pr$x[, 1:3]
## Take the first 3 PCs
dist.pc <- dist(wisc.pr$x[, 1:3])
## Take the first 3 PCs
dist.pc <- dist(wisc.pr$x[, 1:3])
wisc.pr.hclust <- hclust(dist.pc, method = "ward.D2")
plot(wisc.pr.hclust)
plot(wisc.pr.hclust)
abline(h = 70, col="red")
grps <- cutree(wisc.pr.hclust, k = 70)
grps <- cutree(wisc.pr.hclust, k = 70)
tble(grps)
grps <- cutree(wisc.pr.hclust, k = 70)
table(grps)
table(grps, diagnosis)
grps <- cutree(wisc.pr.hclust, h = 70)
table(grps)
table(grps, diagnosis)
#url <- "new_samples.csv"
url <- "https://tinyurl.com/new-samples-CSV"
new <- read.csv(url)
npc <- predict(wisc.pr, newdata=new)
npc
plot(wisc.pr$x[,1:2], col=g)
plot(wisc.pr$x[,1:2], col=diagnosis)
points(npc[,1], npc[,2], col="blue", pch=16, cex=3)
text(npc[,1], npc[,2], c(1,2), col="white")
# variance proportions from the PCA object
prop_var <- (wisc.pr$sdev^2) / sum(wisc.pr$sdev^2)
cum_var  <- cumsum(prop_var)
# Q4: proportion captured by PC1
Q4_PC1 <- prop_var[1]
round(Q4_PC1, 4)
# Q5: # of PCs for at least 70% variance
Q5_n70 <- which(cum_var >= 0.70)[1]
Q5_n70
# Q6: # of PCs for at least 90% variance
Q6_n90 <- which(cum_var >= 0.90)[1]
Q6_n90
# Basic biplot of the PCA you already computed
biplot(wisc.pr, scale = 0, cex = 0.5, col = c("grey50","tomato"),
xlab = "PC1", ylab = "PC2",
main = "Biplot: Wisconsin Cancer PCA (PC1 vs PC2)")
# Basic biplot of the PCA you already computed
biplot(wisc.pr, scale = 0, cex = 0.5, col = c("grey50","tomato"),
xlab = "PC1", ylab = "PC2",
main = "Biplot: Wisconsin Cancer PCA (PC1 vs PC2)")
# Make a data frame of PC scores and add the labels
df <- as.data.frame(wisc.pr$x)
df$diagnosis <- diagnosis   # factor
# PC1 vs PC3
library(ggplot2)
ggplot(df, aes(PC1, PC3, color = diagnosis)) +
geom_point(alpha = 0.8) +
labs(title = "PC1 vs PC3 by diagnosis",
x = "PC1", y = "PC3") +
theme_classic()
# k = 4 clusters
k <- 4
hts <- sort(wisc.hc$height, decreasing = TRUE)
# k = 4 clusters
k <- 4
hts <- sort(wisc.hclust$height, decreasing = TRUE)
# any h in (hts[k], hts[k-1]] yields k clusters; take the midpoint
cut_h <- mean(hts[k-1:k])
cut_h  # <- this is the height you can report
# visualize
plot(wisc.hclust)
abline(h = cut_h, col = "red", lty = 2)
# (optional) confirm you indeed get 4 clusters
table(cutree(wisc.hc, k = k))
# k = 4 clusters
k <- 4
hts <- sort(wisc.hclust$height, decreasing = TRUE)
# any h in (hts[k], hts[k-1]] yields k clusters; take the midpoint
cut_h <- mean(hts[k-1:k])
cut_h  # <- this is the height you can report
# visualize
plot(wisc.hclust)
abline(h = cut_h, col = "red", lty = 2)
# (optional) confirm you indeed get 4 clusters
table(cutree(wisc.hclust, k = k))
# helper: map clusters -> labels by majority vote, then accuracy/sens/spec
cluster_metrics <- function(cl, truth = diagnosis) {
tab <- table(cl, truth)
map <- apply(tab, 1, function(r) names(which.max(r)))
pred <- factor(map[as.character(cl)], levels = levels(truth))
cm <- table(pred, truth)
acc <- mean(pred == truth)
sens <- cm["M","M"] / sum(cm[ , "M"])        # TPR for Malignant
spec <- cm["B","B"] / sum(cm[ , "B"])        # TNR for Benign
list(acc = acc, sens = sens, spec = spec, cm = cm)
}
# evaluate cutting the PC-space tree at k = 2:10
ks <- 2:10
pc_k_results <- lapply(ks, function(k){
cl <- cutree(wisc.pr.hclust, k = k)
cluster_metrics(cl)
})
acc_by_k <- sapply(pc_k_results, `[[`, "acc")
data.frame(k = ks, accuracy = round(acc_by_k, 4))
methods <- c("single", "complete", "average", "ward.D2")
link_res <- lapply(methods, function(m) {
hc <- hclust(data.dist, method = m)
cluster_metrics(cutree(hc, k = 2))   # two true classes
})
data.frame(
method = methods,
accuracy = sapply(link_res, `[[`, "acc"),
sensitivity = sapply(link_res, `[[`, "sens"),
specificity = sapply(link_res, `[[`, "spec")
)
set.seed(1)
wisc.km <- kmeans(data.scaled, centers = 2, nstart = 50)
km_res  <- cluster_metrics(wisc.km$cluster)
hc2_res <- cluster_metrics(cutree(wisc.hclust, k = 2))
km_res$cm; round(c(km_acc = km_res$acc, km_sens = km_res$sens, km_spec = km_res$spec), 3)
hc2_res$cm; round(c(hc_acc = hc2_res$acc, hc_sens = hc2_res$sens, hc_spec = hc2_res$spec), 3)
hc4_res <- cluster_metrics(wisc.hclust.clusters)
hc4_res$cm
round(c(acc = hc4_res$acc, sens = hc4_res$sens, spec = hc4_res$spec), 3)
# Plain cross-tabs (what the question asks for)
table(wisc.km$cluster, diagnosis)
table(wisc.hclust.clusters, diagnosis)
# Collect all contenders you tried
summary_df <- rbind(
cbind(model = "hclust complete k=2",  t(unlist(hc2_res[c("acc","sens","spec")]))),
cbind(model = "hclust complete k=4",  t(unlist(hc4_res[c("acc","sens","spec")]))),
cbind(model = "kmeans k=2",          t(unlist(km_res[c("acc","sens","spec")]))),
cbind(model = sprintf("PC Ward.D2 k=%d", ks[which.max(acc_by_k)]),
t(unlist(pc_k_results[[which.max(acc_by_k)]][c("acc","sens","spec")])))
)
summary_df
